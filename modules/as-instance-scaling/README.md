# AS instance scaling management

Manages the AS instance scaling.

## Notes

### How to import resources in the module structure

Please make sure that the corresponding module script has been defined in your `.tf` file, like this:

```hcl
# Manages an AS group.
module "as_instance_scaling" {
  source = "github.com/terraform-huaweicloud-modules/terraform-huaweicloud-as/modules/as-instance-scaling"

  ...
}
```

Execute the following command to import the corresponding resource into the management of the `.tfstate` file.

```bash
$ terraform import module.as_instance_scaling.huaweicloud_as_group.this[0] "as_group_id"

module.as_instance_scaling.huaweicloud_as_group.this[0]: Importing from ID "as_group_id"...
module.as_instance_scaling.huaweicloud_as_group.this[0]: Import prepared!
  Prepared huaweicloud_as_group for import
module.as_instance_scaling.huaweicloud_as_group.this[0]: Refreshing state... [id=as_group_id]

Import successful!

The resources that were imported are shown above. These resources are now in
your Terraform state and will henceforth be managed by Terraform.
```

### What should we do before deploy this module example

Before manage AS resources, the access key (AK, the corresponding environment name is `HW_ACCESS_KEY`) and the secret
key (SK, the corresponding environment name is `HW_SECRET_KEY`) should be configured.

For the linux VM, you can configure the corresponding environment variables with the following commands:

```bash
$ export HW_ACCESS_KEY=XXXXXXXXXXXXXXXXXXXX
$ export HW_SECRET_KEY=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

Refer to this [document](https://support.huaweicloud.com/intl/en-us/devg-apisign/api-sign-provide-aksk.html) for AK/SK
information obtain.

## Contributing

Report issues/questions/feature requests in
the [issues](https://github.com/terraform-huaweicloud-modules/terraform-huaweicloud-as/issues/new)
section.

Full contributing [guidelines are covered here](../../.github/how_to_contribute.md).

## Requirements

| Name                 | Version   |
|----------------------|-----------|
| Terraform            | >= 1.3.0  |
| Huaweicloud Provider | >= 1.73.0 |

## Modules

No module.

## Resources

| Name                                | Type     |
|-------------------------------------|----------|
| huaweicloud_as_configuration.this   | resource |
| huaweicloud_as_group.this           | resource |
| huaweicloud_as_instance_attach.this | resource |
| huaweicloud_as_policy.this          | resource |

## Inputs

<!-- markdownlint-disable MD013 -->
| Name                                     | Description                                                                                          | Type                                                                                                                                                                                                                                                                                                                                                                                                                                           |           Default           | Required |
|------------------------------------------|------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------:|:--------:|
| is_configuration_create                  | Controls whether the AS configuration should be created                                              | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                         |           `true`            |    N     |
| configuration_name                       | The AS configuration name                                                                            | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_instance_id                | The ECS instance ID when using its specification as the template to create AS configurations         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_flavor                     | The ECS flavor name                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_image                      | The ECS image ID                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_key_name                   | The name of the SSH key pair used to log in to the instance                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_security_group_ids         | An array of one or more security group IDs                                                           | <pre>list(string)</pre>                                                                                                                                                                                                                                                                                                                                                                                                                        |           `null`            |    N     |
| configuration_charging_mode              | The billing mode for an ECS                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |        `"postPaid"`         |    N     |
| configuration_flavor_priority_policy     | The priority policy used when there are multiple flavors and instances to be created using an AS ... | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_ecs_group_id               | The ECS group ID                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_disk                       | The disk group information                                                                           | <pre>list(object({<br>    size                 = optional(number)     volume_type          = optional(string)     disk_type            = optional(string)     kms_id               = optional(string)     iops                 = optional(number)     throughput           = optional(number)     dedicated_storage_id = optional(string)     data_disk_image_id   = optional(string)     snapshot_id          = optional(string)<br>}))</pre> |           `null`            |    N     |
| configuration_personality                | The customize personality of an instance by defining one or more files and their contents            | <pre>list(object({<br>    path    = optional(string)     content = optional(string)<br>}))</pre>                                                                                                                                                                                                                                                                                                                                               |           `null`            |    N     |
| configuration_public_ip                  | The EIP of the ECS instance                                                                          | <pre>list(object({<br>    eip = list(object({<br>    ip_type   = optional(string)       bandwidth = list(object({<br>    share_type    = optional(string)         charging_mode = optional(string)         size          = optional(number)         id            = optional(string)<br>}))     <br>}))   <br>}))</pre>                                                                                                                        |           `null`            |    N     |
| configuration_tenancy                    | Whether to create ECS instances on DeHs                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_dedicated_host_id          | The ID of the DEH                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_user_data                  | The user data to be injected during the ECS creation process                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_admin_pass                 | The initial login password of the administrator account for logging in to an ECS using password a... | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| configuration_metadata                   | The key/value pairs to make available from within the instance                                       | <pre>map(string)</pre>                                                                                                                                                                                                                                                                                                                                                                                                                         |           `null`            |    N     |
| is_group_create                          | Controls whether the AS group should be created                                                      | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                         |           `true`            |    N     |
| group_name                               | The name of the scaling group                                                                        | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_configuration_id                   | The configuration ID which defines configurations of instances in the AS group                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_desire_instance_number             | The expected number of instances                                                                     | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_min_instance_number                | The minimum number of instances                                                                      | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_max_instance_number                | The maximum number of instances                                                                      | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_cool_down_time                     | The cooling duration (in seconds)                                                                    | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                       |             300             |    N     |
| group_lbaas_listeners                    | An array of one or more enhanced load balancer                                                       | <pre>list(object({<br>    pool_id          = optional(string)     protocol_port    = optional(number)     weight           = optional(number)     protocol_version = optional(string)<br>}))</pre>                                                                                                                                                                                                                                             |           `null`            |    N     |
| group_vpc_id                             | The VPC ID                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_networks                           | An array of one or more network IDs                                                                  | <pre>list(object({<br>    id                = optional(string)     ipv6_enable       = optional(bool)     ipv6_bandwidth_id = optional(string)     source_dest_check = optional(bool)<br>}))</pre>                                                                                                                                                                                                                                             |           `null`            |    N     |
| group_security_groups                    | An array of one or more security group IDs to associate with the group                               | <pre>list(object({<br>    id = optional(string)<br>}))</pre>                                                                                                                                                                                                                                                                                                                                                                                   |           `null`            |    N     |
| group_availability_zones                 | The availability zones in which to create the instances in the autoscaling group                     | <pre>list(string)</pre>                                                                                                                                                                                                                                                                                                                                                                                                                        |           `null`            |    N     |
| group_multi_az_scaling_policy            | The priority policy used to select target AZs when adjusting the number of instances in an AS group  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_health_periodic_audit_method       | The health check method for instances in the AS group                                                | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |       `"NOVA_AUDIT"`        |    N     |
| group_health_periodic_audit_time         | The health check period for instances                                                                | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                       |              5              |    N     |
| group_health_periodic_audit_grace_period | The health check grace period for instances                                                          | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_instance_terminate_policy          | The instance removal policy                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       | `"OLD_CONFIG_OLD_INSTANCE"` |    N     |
| group_agency_name                        | The IAM agency name                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_delete_publicip                    | Whether to release the EIPs bound to ECSs when the ECSs are removed from the AS group                | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                         |           `null`            |    N     |
| group_delete_volume                      | Whether to delete the data disks attached to ECSs when the ECSs are removed                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                         |           `null`            |    N     |
| group_delete_instances                   | Whether to delete the instances in the AS group when deleting the AS group                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `"no" `           |    N     |
| group_force_delete                       | Whether to forcibly delete the AS group                                                              | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                         |           `null`            |    N     |
| group_enable                             | Whether to enable the AS Group                                                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                         |           `true`            |    N     |
| group_description                        | The description of the AS group                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| group_tags                               | The key/value pairs to associate with the AS group                                                   | <pre>map(string)</pre>                                                                                                                                                                                                                                                                                                                                                                                                                         |           `null`            |    N     |
| group_enterprise_project_id              | The enterprise project ID of the AS group                                                            | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| attach_instances_configuration           | The attach instances configuration                                                                   | <pre>list(object({<br>    instance_id      = optional(string)     scaling_group_id = optional(string)     protected        = optional(bool)     standby          = optional(bool)     append_instance  = optional(bool)<br>}))</pre>                                                                                                                                                                                                           |           `null`            |    N     |
| is_policy_create                         | Controls whether the AS policy should be created                                                     | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                         |           `true`            |    N     |
| policy_name                              | the name of the AS policy                                                                            | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| policy_group_id                          | the AS group ID                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| policy_type                              | the AS policy type                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| policy_alarm_id                          | the alarm rule ID                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| policy_scheduled_policy                  | the periodic or scheduled AS policy                                                                  | <pre>list(object({<br>    launch_time      = optional(string)     recurrence_type  = optional(string)     recurrence_value = optional(string)     start_time       = optional(string)     end_time         = optional(string)<br>}))</pre>                                                                                                                                                                                                     |           `null`            |    N     |
| policy_scaling_policy_action             | the action of the AS policy                                                                          | <pre>list(object({<br>    operation           = optional(string)     instance_number     = optional(number)     instance_percentage = optional(number)<br>}))</pre>                                                                                                                                                                                                                                                                            |           `null`            |    N     |
| policy_cool_down_time                    | the cooling duration (in seconds)                                                                    | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
| policy_action                            | the operation for the AS policy                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                       |           `null`            |    N     |
<!-- markdownlint-enable MD013 -->

## Outputs

| Name             | Description                    |
|------------------|--------------------------------|
| configuration_id | The ID of the AS configuration |
| group_id         | The ID of the AS group         |
| policy_id        | The ID of the AS policy        |
